
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Resource Specification &#8212; OpenSCADA 1.0 documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Instruction List Programming" href="il_programming.html" />
    <link rel="prev" title="System Specification" href="system_specification.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>OpenSCADA 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>Resource Specification</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="system_specification.html">System Specification</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="il_programming.html">Instruction List Programming</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="resource-specification">
<h1>Resource Specification<a class="headerlink" href="#resource-specification" title="Permalink to this headline">¶</a></h1>
<p>The specification of a PLC’s CPU is provided as a prototxt file of the ResourceSpecification proto message format specified in <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/src/pc_emulator/proto/configuration.proto/">configuration.proto</a> file. In this guide we will use an example of the proto definition given <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/examples/inverted_pendulum/CPU_001.proto/txt">here</a>.</p>
<p><strong>resource_name</strong>: Name of the CPU:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource_name</span><span class="p">:</span> <span class="s2">&quot;CPU_001&quot;</span>
</pre></div>
</div>
<p><strong>input_mem_size_bytes</strong>: Input memory size of the CPU. Sensors may be connected to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_mem_size_bytes</span><span class="p">:</span> <span class="mi">10000</span>
</pre></div>
</div>
<p><strong>output_mem_size_bytes</strong>: Output memory size of the CPU. Actuators may be connected to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output_mem_size_bytes</span><span class="p">:</span> <span class="mi">10000</span>
</pre></div>
</div>
<p><strong>resource_global_var</strong>: Global variables which are visible to only Program Organization Units (POU) defined in this resource: Function blocks (FB), Functions (FN) and Programs (PROGRAM). In this example two CPU level global variables are defined. “current_theta” is stored in byte number 1 of the input memory whereas “force” is stored at byte number 1 of the output memory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource_global_var</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;__RESOURCE_GLOBAL__&quot;</span>
    <span class="n">datatype_field</span> <span class="p">{</span>
        <span class="n">field_name</span><span class="p">:</span> <span class="s2">&quot;current_theta&quot;</span>
        <span class="n">field_datatype_name</span><span class="p">:</span> <span class="s2">&quot;REAL&quot;</span>
        <span class="n">intf_type</span> <span class="p">:</span> <span class="n">VAR_EXPLICIT_STORAGE</span>
        <span class="n">field_storage_spec</span> <span class="p">{</span>
            <span class="n">mem_type</span><span class="p">:</span> <span class="n">INPUT_MEM</span>
            <span class="n">byte_offset</span><span class="p">:</span> <span class="mi">1</span>
            <span class="n">bit_offset</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">datatype_field</span> <span class="p">{</span>
        <span class="n">field_name</span><span class="p">:</span> <span class="s2">&quot;force&quot;</span>
        <span class="n">field_datatype_name</span><span class="p">:</span> <span class="s2">&quot;REAL&quot;</span>
        <span class="n">intf_type</span> <span class="p">:</span> <span class="n">VAR_EXPLICIT_STORAGE</span>
        <span class="n">field_storage_spec</span> <span class="p">{</span>
            <span class="n">mem_type</span><span class="p">:</span> <span class="n">OUTPUT_MEM</span>
            <span class="n">byte_offset</span><span class="p">:</span> <span class="mi">1</span>
            <span class="n">bit_offset</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>pou_var</strong>: A CPU can define multiple pou_var messages. These describe a POU. A POU could be of type FB, FN or PROGRAM and they contain and interface declaration and a code body to hold all the IL instructions associated with POU. POUs are equivalent to functions in the traditional programming sense but FBs and PROGRAMs can hold and update some internal state which can be used each time they are invoked. For further details on the expected behaviour of FBs, FNs and PROGRAMs, please refer to the included book. More details on how to define POUs and their interfaces and code bodies would be included in the IL programming section.</p>
<p>In this example, 3 POUs are defined. Two of them are Function Blocks, while one of them is a PROGRAM. Each POU has its interface specified as a set of datatype_field and code specified in a code_body section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pou_var</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;DivideFB&quot;</span>
    <span class="n">pou_type</span><span class="p">:</span> <span class="n">FB</span>
    <span class="n">datatype_field</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
    <span class="n">datatype_field</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
    <span class="o">...</span>

    <span class="n">code_body</span> <span class="p">{</span>
        <span class="n">insn</span><span class="p">:</span> <span class="s2">&quot;LD 0.0&quot;</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">pou_var</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;GetControlInputFB&quot;</span>
    <span class="n">pou_type</span><span class="p">:</span> <span class="n">FB</span>
    <span class="n">datatype_field</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
    <span class="o">...</span>

    <span class="n">code_body</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">pou_var</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;PID_CONTROL&quot;</span>
    <span class="n">pou_type</span><span class="p">:</span> <span class="n">PROGRAM</span>
    <span class="n">datatype_field</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
    <span class="o">...</span>
    <span class="n">code_body</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>interval_task</strong>: This field is used to specify a task which gets invoked periodically according to the specified period. Programs and Function Blocks could be attached to this task and periodically invoked. In OpenSCADA, for each CPU, only one interval task can be specified. In this example, the interval task is called “CYCLIC_TASK” and it executes one every 10ms.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interval_task</span> <span class="p">{</span>
    <span class="n">task_name</span><span class="p">:</span> <span class="s2">&quot;CYCLIC_TASK&quot;</span>
    <span class="n">priority</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">interval_task_params</span> <span class="p">{</span>
        <span class="n">interval_ms</span><span class="p">:</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>programs</strong>: Used to attach POUs to tasks. POUs can be attached to tasks with the programs field. It is a message of type ProgramSpecification described in <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/src/pc_emulator/proto/configuration.proto/">configuration.proto</a>. Each programs field defines a mapping between a POU of interest and a task of interest. Multiple POUs can be attached to the same task. A separate programs field is used for each attachement. In this example the POU “PID_CONTROL” is attached with the task “CYCLIC_TASK”. Thus the program “PID_CONTROL” gets invoked every 10ms.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">programs</span> <span class="p">{</span>
    <span class="n">program_name</span><span class="p">:</span> <span class="s2">&quot;PID_CONTROL&quot;</span>
    <span class="n">pou_variable_type</span><span class="p">:</span> <span class="s2">&quot;PID_CONTROL&quot;</span>
    <span class="n">task_name</span><span class="p">:</span> <span class="s2">&quot;CYCLIC_TASK&quot;</span>
    <span class="n">initialization_maps</span> <span class="p">{</span>
        <span class="n">pou_variable_field_name</span><span class="p">:</span> <span class="s2">&quot;dummy_in&quot;</span>
        <span class="n">mapped_variable_field_name</span><span class="p">:</span> <span class="s2">&quot;start_int&quot;</span>
    <span class="p">}</span>
    <span class="n">initialization_maps</span> <span class="p">{</span>
        <span class="n">pou_variable_field_name</span><span class="p">:</span> <span class="s2">&quot;dummy_out&quot;</span>
        <span class="n">mapped_variable_field_name</span><span class="p">:</span> <span class="s2">&quot;global_int_var&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Arguments to each invocation of the POU can be passed through initialization_maps (a subfield of the ProgramSpecification message). Initialization maps can be used to initialize the POUs input/inout variables as well as specify where output variables could be stored after the invocation. In this example, the program “PID_CONTROL“‘s input variable “dummy_in” at the start of every invocation is assigned the value of the global variable “start_int” (which was specified in the System specification i.e, in the previous section). At the end of the invocation, the value of the output variable of the PROGRAM called “dummy_out” is copied to “global_int_var” (which was created in the previous section as a PLC level global variable). It must be noted that the mapped_variable_field_name for an VAR_INPUT variable could also be an immediate value. For instance in the above example, if “dummy_in” needs to be initialized with 10 for every invocation, the initialization map could be modified to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">initialization_maps</span> <span class="p">{</span>
    <span class="n">pou_variable_field_name</span><span class="p">:</span> <span class="s2">&quot;dummy_in&quot;</span>
    <span class="n">mapped_variable_field_name</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="system_specification.html">System Specification</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="il_programming.html">Instruction List Programming</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Vignesh Babu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>