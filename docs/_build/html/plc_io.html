
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PLC I/O &#8212; OpenSCADA 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PLC Communication" href="plc_communication.html" />
    <link rel="prev" title="Starting the PLC" href="running_plc.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="plc-i-o">
<h1>PLC I/O<a class="headerlink" href="#plc-i-o" title="Permalink to this headline">¶</a></h1>
<p>This section discusses how to interact with a PLC to read its CPU’s output memory and set values to its CPU’s input memory. The ability to write values to the input memory of a PLC’s CPU is necessary to simulate sensors in the physical environment. Sensors typically measure quantities in the physical system and these measured values appear in the input memory. The ability to read values from the output memory of a PLC’s CPU is necessary to simulate actuators. The PLC’s logic typically writes values to the output memory and this is sent to one or more connected actuators. To write/read from input/output memories of a PLC’s CPU, OpenSCADA provides a unified grpc interface.</p>
<p>A grpc server is started and pointed to a directory containing the system specification files of all interested PLCs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pc_grpc_server</span> <span class="o">&lt;</span><span class="n">Path</span> <span class="n">to</span> <span class="n">directory</span> <span class="n">containing</span> <span class="n">system</span> <span class="n">specification</span> <span class="n">files</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">PLCs</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The GRPC server binds to localhost and listens on port 50051. It can be quit any time by pressing Ctrl-C (i.e by sending an interrupt signal).</p>
<p>For every PLC, the GRPC server upon startup reads its system spec file and creates a memory mapped files to store the contents of the input/output memories of each CPU. The PLC itself doesn’t need to be running at this time and it could even be started after the GRPC server has been setup. When the PLC is launched, it will re-use the already created memory mapped files for the input/output memories of each CPU. Through memory mapped I/O, the GRPC server would be able to write to a CPU’s input memory or read from its output memory. GRPC requests can be sent by external processes to write(read) to(from) the input(output) memory of a specific CPU in a particular PLC. In the following sections, we show how to construct grpc requests to write to input memory and read from output memory</p>
<div class="section" id="simulating-sensors">
<h2>Simulating Sensors<a class="headerlink" href="#simulating-sensors" title="Permalink to this headline">¶</a></h2>
<p>Sensors are attached to a specific CPU of a PLC and write to its input memory. To simulate a sensor, the SetSensorInput defined in <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/src/pc_emulator/proto/mem_access.proto/">mem_access.proto</a> can be used. It needs a request message of type SensorInput with the following fields which need to be set:</p>
<ul class="simple">
<li><strong>PLC_ID</strong>: ID of the PLC or the configuration_name specified in its system specification</li>
<li><strong>ResourceName</strong>: CPU Name inside the PLC</li>
<li><strong>MemType</strong>: Should typically be 0 - to denote Input Memory</li>
<li><strong>ByteOffset</strong>: Starting byte address inside the memory</li>
<li><strong>BitOffset</strong>: Starting bit address inside the memory. Ignored unless variable datatype is BOOL.</li>
<li><strong>VariableDataTypeName</strong>: Name of the variable data type. For instance if the variable data type is INT, then the memory location referred to by the ByteOffset is interpreted as an INT pointer. The value passed in the ValueToSet field is storedover 2 bytes (since sizeof(INT) is 2 bytes) starting at ByteOffset. Only elementary data type names specified in configuration.proto are allowed.</li>
<li><strong>ValueToSet</strong>: String representation of the value to set. Note that each datatype has a unique string representation as discussed in the IL-Programming section.</li>
</ul>
<div class="section" id="illustration">
<h3>Illustration<a class="headerlink" href="#illustration" title="Permalink to this headline">¶</a></h3>
<p>The following python function accepts a floating point argument called “curr_theta” and copies it to the input memory of CPU: “CPU_001” belonging a PLC called “Pendulum_PLC”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_sensor_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curr_theta</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="s1">&#39;localhost:50051&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">stub</span> <span class="o">=</span> <span class="n">mem_access_grpc</span><span class="o">.</span><span class="n">AccessServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">SetSensorInput</span><span class="p">(</span>
                    <span class="n">mem_access_proto</span><span class="o">.</span><span class="n">SensorInput</span><span class="p">(</span>
                        <span class="n">PLC_ID</span><span class="o">=</span><span class="s1">&#39;Pendulum_PLC&#39;</span><span class="p">,</span>
                        <span class="n">ResourceName</span><span class="o">=</span><span class="s1">&#39;CPU_001&#39;</span><span class="p">,</span>
                        <span class="n">MemType</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ByteOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">BitOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">VariableDataTypeName</span><span class="o">=</span><span class="s2">&quot;REAL&quot;</span><span class="p">,</span>
                        <span class="n">ValueToSet</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_theta</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="simulating-actuators">
<h2>Simulating Actuators<a class="headerlink" href="#simulating-actuators" title="Permalink to this headline">¶</a></h2>
<p>Actuators are attached to a specific CPU of a PLC and read from its output memory. To simulate an actuator, the GetActuatorOutput defined in <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/src/pc_emulator/proto/mem_access.proto/">mem_access.proto</a> can be used. It needs a request message of type ActuatorOutput with the following fields which need to be set:</p>
<ul class="simple">
<li><strong>PLC_ID</strong>: ID of the PLC or the configuration_name specified in its system specification</li>
<li><strong>ResourceName</strong>: CPU Name inside the PLC</li>
<li><strong>MemType</strong>: Should typically be 0 - to denote Input Memory</li>
<li><strong>ByteOffset</strong>: Starting byte address inside the memory</li>
<li><strong>BitOffset</strong>: Starting bit address inside the memory. Ignored unless variable datatype is BOOL.</li>
<li><strong>VariableDataTypeName</strong>: Name of the variable data type. For instance if the variable data type is INT, then the memory location referred to by the ByteOffset is interpreted as an INT pointer. The content of memory location over 2 bytes (since sizeof(INT) is 2 bytes) starting at ByteOffset is returned. Only elementary data type names specified in configuration.proto are allowed.</li>
</ul>
<div class="section" id="id2">
<h3>Illustration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The following python function returns a floating point number starting at byte 1 of the output memory of CPU: “CPU_001” belonging to a PLC called “Pendulum_PLC”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_actuator_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="s1">&#39;localhost:50051&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">stub</span> <span class="o">=</span> <span class="n">mem_access_grpc</span><span class="o">.</span><span class="n">AccessServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">GetActuatorOutput</span><span class="p">(</span>
                    <span class="n">mem_access_proto</span><span class="o">.</span><span class="n">ActuatorOutput</span><span class="p">(</span>
                        <span class="n">PLC_ID</span><span class="o">=</span><span class="s1">&#39;Pendulum_PLC&#39;</span><span class="p">,</span>
                        <span class="n">ResourceName</span><span class="o">=</span><span class="s1">&#39;CPU_001&#39;</span><span class="p">,</span>
                        <span class="n">MemType</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">ByteOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">BitOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">VariableDataTypeName</span><span class="o">=</span><span class="s2">&quot;REAL&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">OpenSCADA</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_configuration.html">Creating a PLC</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_specification.html">System Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="resource_specification.html">Resource Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="il_programming.html">Instruction List Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_plc.html">Starting the PLC</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PLC I/O</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulating-sensors">Simulating Sensors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#illustration">Illustration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#simulating-actuators">Simulating Actuators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Illustration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plc_communication.html">PLC Communication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_topics.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers_guide.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="user_guide.html">User Guide</a><ul>
      <li>Previous: <a href="running_plc.html" title="previous chapter">Starting the PLC</a></li>
      <li>Next: <a href="plc_communication.html" title="next chapter">PLC Communication</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Vignesh Babu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/plc_io.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>