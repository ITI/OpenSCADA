
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PLC I/O &#8212; OpenSCADA 1.0 documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PLC Communication" href="plc_communication.html" />
    <link rel="prev" title="Starting the PLC" href="running_plc.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>OpenSCADA 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>PLC I/O</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="running_plc.html">Starting the PLC</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="plc_communication.html">PLC Communication</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="plc-i-o">
<h1>PLC I/O<a class="headerlink" href="#plc-i-o" title="Permalink to this headline">¶</a></h1>
<p>This section discusses how to interact with a PLC to read its CPU’s output memory and set values to its CPU’s input memory. The ability to write values to the input memory of a PLC’s CPU is necessary to simulate sensors in the physical environment. Sensors typically measure quantities in the physical system and these measured values appear in the input memory. The ability to read values from the output memory of a PLC’s CPU is necessary to simulate actuators. The PLC’s logic typically writes values to the output memory and this is sent to one or more connected actuators. To write/read from input/output memories of a PLC’s CPU, OpenSCADA provides a unified grpc interface.</p>
<p>A grpc server is started and pointed to a directory containing the system specification files of all interested PLCs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pc_grpc_server</span> <span class="o">&lt;</span><span class="n">Path</span> <span class="n">to</span> <span class="n">directory</span> <span class="n">containing</span> <span class="n">system</span> <span class="n">specification</span> <span class="n">files</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">PLCs</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The GRPC server binds to localhost and listens on port 50051. It can be quit any time by pressing Ctrl-C (i.e by sending an interrupt signal).</p>
<p>For every PLC, the GRPC server upon startup reads its system spec file and creates a memory mapped files to store the contents of the input/output memories of each CPU. The PLC itself doesn’t need to be running at this time and it could even be started after the GRPC server has been setup. When the PLC is launched, it will re-use the already created memory mapped files for the input/output memories of each CPU. Through memory mapped I/O, the GRPC server would be able to write to a CPU’s input memory or read from its output memory. GRPC requests can be sent by external processes to write(read) to(from) the input(output) memory of a specific CPU in a particular PLC. In the following sections, we show how to construct grpc requests to write to input memory and read from output memory</p>
<div class="section" id="simulating-sensors">
<h2>Simulating Sensors<a class="headerlink" href="#simulating-sensors" title="Permalink to this headline">¶</a></h2>
<p>Sensors are attached to a specific CPU of a PLC and write to its input memory. To simulate a sensor, the SetSensorInput defined in <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/src/pc_emulator/proto/mem_access.proto/">mem_access.proto</a> can be used. It needs a request message of type SensorInput with the following fields which need to be set:</p>
<ul class="simple">
<li><strong>PLC_ID</strong>: ID of the PLC or the configuration_name specified in its system specification</li>
<li><strong>ResourceName</strong>: CPU Name inside the PLC</li>
<li><strong>MemType</strong>: Should typically be 0 - to denote Input Memory</li>
<li><strong>ByteOffset</strong>: Starting byte address inside the memory</li>
<li><strong>BitOffset</strong>: Starting bit address inside the memory. Ignored unless variable datatype is BOOL.</li>
<li><strong>VariableDataTypeName</strong>: Name of the variable data type. For instance if the variable data type is INT, then the memory location referred to by the ByteOffset is interpreted as an INT pointer. The value passed in the ValueToSet field is storedover 2 bytes (since sizeof(INT) is 2 bytes) starting at ByteOffset. Only elementary data type names specified in configuration.proto are allowed.</li>
<li><strong>ValueToSet</strong>: String representation of the value to set. Note that each datatype has a unique string representation as discussed in the IL-Programming section.</li>
</ul>
<div class="section" id="illustration">
<h3>Illustration<a class="headerlink" href="#illustration" title="Permalink to this headline">¶</a></h3>
<p>The following python function accepts a floating point argument called “curr_theta” and copies it to the input memory of CPU: “CPU_001” belonging a PLC called “Pendulum_PLC”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_sensor_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curr_theta</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="s1">&#39;localhost:50051&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">stub</span> <span class="o">=</span> <span class="n">mem_access_grpc</span><span class="o">.</span><span class="n">AccessServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">SetSensorInput</span><span class="p">(</span>
                    <span class="n">mem_access_proto</span><span class="o">.</span><span class="n">SensorInput</span><span class="p">(</span>
                        <span class="n">PLC_ID</span><span class="o">=</span><span class="s1">&#39;Pendulum_PLC&#39;</span><span class="p">,</span>
                        <span class="n">ResourceName</span><span class="o">=</span><span class="s1">&#39;CPU_001&#39;</span><span class="p">,</span>
                        <span class="n">MemType</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ByteOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">BitOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">VariableDataTypeName</span><span class="o">=</span><span class="s2">&quot;REAL&quot;</span><span class="p">,</span>
                        <span class="n">ValueToSet</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_theta</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="simulating-actuators">
<h2>Simulating Actuators<a class="headerlink" href="#simulating-actuators" title="Permalink to this headline">¶</a></h2>
<p>Actuators are attached to a specific CPU of a PLC and read from its output memory. To simulate an actuator, the GetActuatorOutput defined in <a class="reference external" href="https://github.com/Vignesh2208/OpenSCADA/tree/master/src/pc_emulator/proto/mem_access.proto/">mem_access.proto</a> can be used. It needs a request message of type ActuatorOutput with the following fields which need to be set:</p>
<ul class="simple">
<li><strong>PLC_ID</strong>: ID of the PLC or the configuration_name specified in its system specification</li>
<li><strong>ResourceName</strong>: CPU Name inside the PLC</li>
<li><strong>MemType</strong>: Should typically be 0 - to denote Input Memory</li>
<li><strong>ByteOffset</strong>: Starting byte address inside the memory</li>
<li><strong>BitOffset</strong>: Starting bit address inside the memory. Ignored unless variable datatype is BOOL.</li>
<li><strong>VariableDataTypeName</strong>: Name of the variable data type. For instance if the variable data type is INT, then the memory location referred to by the ByteOffset is interpreted as an INT pointer. The content of memory location over 2 bytes (since sizeof(INT) is 2 bytes) starting at ByteOffset is returned. Only elementary data type names specified in configuration.proto are allowed.</li>
</ul>
<div class="section" id="id2">
<h3>Illustration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The following python function returns a floating point number starting at byte 1 of the output memory of CPU: “CPU_001” belonging to a PLC called “Pendulum_PLC”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_actuator_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="s1">&#39;localhost:50051&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">stub</span> <span class="o">=</span> <span class="n">mem_access_grpc</span><span class="o">.</span><span class="n">AccessServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">GetActuatorOutput</span><span class="p">(</span>
                    <span class="n">mem_access_proto</span><span class="o">.</span><span class="n">ActuatorOutput</span><span class="p">(</span>
                        <span class="n">PLC_ID</span><span class="o">=</span><span class="s1">&#39;Pendulum_PLC&#39;</span><span class="p">,</span>
                        <span class="n">ResourceName</span><span class="o">=</span><span class="s1">&#39;CPU_001&#39;</span><span class="p">,</span>
                        <span class="n">MemType</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">ByteOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">BitOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">VariableDataTypeName</span><span class="o">=</span><span class="s2">&quot;REAL&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="running_plc.html">Starting the PLC</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="plc_communication.html">PLC Communication</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Vignesh Babu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>